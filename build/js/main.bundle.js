(()=>{"use strict";const e=e=>"Esc"===e.key||"Escape"===e.key,t=document.querySelector(".big-picture"),r=document.querySelector("body"),n=document.querySelector(".big-picture__cancel"),o=document.querySelector("#comment").content.querySelector(".social__comment"),s=document.querySelector(".social__comments");let c=[];const l=t.querySelector(".social__comment-count"),i=t.querySelector(".comments-loader");let a=5;const d=()=>{t.classList.add("hidden"),r.classList.remove("modal-open"),n.removeEventListener("click",d),s.innerHTML="",document.removeEventListener("keydown",m),a=5,c=[]},u=e=>{a=e.length<5?e.length:a,c=e.slice(0,a),s.innerHTML="",l.textContent=`${c.length} из ${e.length} комментариев`;let t=document.createDocumentFragment();c.forEach((e=>{t.appendChild((e=>{const t=o.cloneNode(!0);return t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__picture").alt=e.name,t.querySelector(".social__text").textContent=e.message,t})(e))})),s.appendChild(t),e.length>5&&c.length<e.length?(i.classList.remove("hidden"),i.addEventListener("click",(()=>{u(e)}),{once:!0})):i.classList.add("hidden"),a+=5},m=t=>{e(t)&&d()},y=document.querySelector("#picture").content.querySelector(".picture"),v=document.querySelector(".pictures"),_=e=>{let o=document.createDocumentFragment();e.forEach((e=>{o.appendChild((e=>{const o=y.cloneNode(!0);return o.querySelector(".picture__img").src=e.url,o.querySelector(".picture__likes").textContent=e.likes,o.querySelector(".picture__comments").textContent=e.comments.length,o.addEventListener("click",(o=>{o.preventDefault(),(e=>{a=5,c=[],r.classList.add("modal-open"),t.querySelector(".big-picture__img > img").src=e.url,t.querySelector(".likes-count").textContent=e.likes,t.querySelector(".social__caption").textContent=e.description,n.addEventListener("click",d),t.classList.remove("hidden"),document.addEventListener("keydown",m),u(e.comments.slice())})(e)})),o})(e))})),v.appendChild(o)},p={GET:"https://22.javascript.pages.academy/kekstagram/data",POST:"https://22.javascript.pages.academy/kekstagram"},g=(e,t,r,n)=>{fetch(p[r],{method:r,body:n}).then((e=>e.json())).then((t=>{e(t)})).catch((()=>{t()}))},h=document.querySelector("main"),L=document.querySelector("#error").content,S=document.createDocumentFragment(),q=document.querySelector("#success").content,f=document.createDocumentFragment(),k=(t,r)=>{e(t)&&w(r)},E=e=>{k(e,".error"),document.removeEventListener("keydown",E)},C=e=>{k(e,".success"),document.removeEventListener("keydown",C)},w=e=>{document.querySelector(e).remove()},b=(e,t)=>{const r=L.cloneNode(!0);r.querySelector(".error__title").textContent=e,r.querySelector(".error__button").textContent=t;const n=r.querySelector(".error__button");r.querySelector(".error").addEventListener("click",(e=>{e.target.classList.contains("error__inner")||(document.removeEventListener("keydown",E),w(".error"))})),n.addEventListener("click",(()=>{w(".error")})),document.addEventListener("keydown",E),S.appendChild(r),h.appendChild(S)},x=document.querySelector(".img-upload__effects"),V=document.querySelector(".img-upload__effect-level"),D=document.querySelector(".effect-level__slider"),T=document.querySelector(".img-upload__preview > img"),$=document.querySelector(".effect-level__value");V.classList.add("visually-hidden");let I="";const M={none:()=>(V.classList.add("visually-hidden"),"none"),chrome:()=>(V.classList.remove("visually-hidden"),`grayscale(${.01*parseInt($.value,10)})`),sepia:()=>(V.classList.remove("visually-hidden"),`sepia(${.01*parseInt($.value,10)})`),marvin:()=>(V.classList.remove("visually-hidden"),`invert(${Math.floor($.value)}%)`),phobos:()=>(V.classList.remove("visually-hidden"),`blur(${3*parseInt($.value,10)*.01}px)`),heat:()=>(V.classList.remove("visually-hidden"),`brightness(${3*parseInt($.value,10)*.01})`)};x.addEventListener("click",(e=>{if(e.target.classList.contains("effects__preview")){""!==I&&T.classList.remove(I),D.noUiSlider.set(100);let t=e.target.classList[1];I=t,T.classList.add(t),T.style.filter=M[t.replace("effects__preview--","")]()}})),noUiSlider.create(D,{range:{min:0,max:100},start:100,connect:"lower"}),D.noUiSlider.on("change",(()=>{$.value=Math.round(D.noUiSlider.get()),T.style.filter=M[I.replace("effects__preview--","")]()}));const F=document.querySelector("body"),U=document.querySelector(".img-upload__overlay"),N=document.querySelector("#upload-file"),O=document.querySelector("#upload-cancel");N.addEventListener("change",(()=>{J(),U.classList.remove("hidden"),F.classList.add("modal-open"),document.addEventListener("keydown",P)}));const j=()=>{U.classList.add("hidden"),F.classList.remove("modal-open"),B.style.border="none",N.value="",K.reset(),D.noUiSlider.set(100),$.value=100,V.classList.add("visually-hidden"),T.style.filter=null,I&&T.classList.remove(I),document.removeEventListener("keydown",P)};O.addEventListener("click",(()=>{j()}));const P=t=>{e(t)&&j()},G=U.querySelector(".scale__control--bigger"),H=U.querySelector(".scale__control--smaller"),A=U.querySelector(".scale__control--value"),z=U.querySelector(".img-upload__preview > img");let B=U.querySelector(".text__hashtags");const J=()=>{z.style="transform: scale(1.00)",A.value="100%"};G.addEventListener("click",(()=>{let e=parseInt(A.value,10)+25;e>=100&&(e=100),A.value=e+"%",e/=100,z.style.transform="scale("+e+")"})),H.addEventListener("click",(()=>{let e=parseInt(A.value,10)-25;e<=25&&(e=25),A.value=e+"%",e/=100,z.style.transform="scale("+e+")"}));const K=document.querySelector(".img-upload__form"),Q=()=>{(e=>{const t=q.cloneNode(!0);t.querySelector(".success__title").textContent="Ура!",t.querySelector(".success").addEventListener("click",(e=>{e.target.classList.contains("success__inner")||(document.removeEventListener("keydown",C),w(".success"))})),document.addEventListener("keydown",C),f.appendChild(t),h.appendChild(f)})(),j()},R=()=>{b("ЧТо-то пошло не так","Загрузить другой файл")};K.addEventListener("submit",(e=>{e.preventDefault(),g(Q,R,"POST",new FormData(e.target))}));let W=document.querySelector(".text__hashtags"),X=document.querySelector(".text__description");X.addEventListener("input",(()=>{X.setCustomValidity(""),X.value.length>140&&X.setCustomValidity("Максимум 140 символов")})),W.addEventListener("input",(()=>{W.setCustomValidity(""),W.style.border="none";let e=W.value.toLowerCase().trim();if(!e)return;let t=e.split(/\s+/);0!==t.length&&(t.some((e=>"#"!==e[0]))&&W.setCustomValidity("Хэш-тег начинается с символа # (решётка)"),t.some((e=>"#"===e))&&W.setCustomValidity("Хэш-тег не может состоять только из решетки"),t.some((e=>e.indexOf("#",1)>=1))&&W.setCustomValidity("Хэш-теги разделяются пробелами"),t.some(((e,t,r)=>r.indexOf(e,t+1)>=t+1))&&W.setCustomValidity("Хэш-теги не должны повторяться"),t.some((e=>e.length>20))&&W.setCustomValidity("Максимальная длина хэш-тега 20 символов, включая решетку"),t.length>5&&W.setCustomValidity("Максимум 5 хэш-тегов"),W.checkValidity()?W.style.border="none":W.style.border="2px solid red")}));const Y=t=>{e(t)&&(t.preventDefault(),t.stopPropagation())};W.addEventListener("keydown",Y),X.addEventListener("keydown",Y);const Z=document.querySelector(".img-filters");let ee=[];const te={"filter-default":()=>{_(ee.slice(0,25))},"filter-random":()=>{_((e=>{let t,r;for(let n=e.length-1;n>0;n--)t=Math.floor(Math.random()*(n+1)),r=e[t],e[t]=e[n],e[n]=r;return e})(ee.slice()).slice(0,10))},"filter-discussed":()=>{_(ee.slice().sort(((e,t)=>t.comments.length-e.comments.length)))}};g((e=>{Z.classList.remove("img-filters--inactive"),ee=e.slice(),_(ee.slice(0,25))}),(()=>{b("Ошибка загрузки, попробуйте еще раз","Закрыть")}),"GET");const re=(e=>{let t=null;return(...e)=>{t&&window.clearTimeout(t),t=window.setTimeout((()=>{(e=>{e.target.classList.contains("img-filters__button")&&(document.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),(()=>{const e=document.querySelectorAll(".picture");e&&e.forEach((e=>{e.remove()}))})(),e.target.classList.add("img-filters__button--active"),te[e.target.id]())})(...e)}),500)}})();Z.addEventListener("click",re)})();
//# sourceMappingURL=main.bundle.js.map